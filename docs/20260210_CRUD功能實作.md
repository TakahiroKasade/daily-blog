# 20260210 CRUD åŠŸèƒ½å¯¦ä½œ (Create / Read / Delete / Update)

## ğŸ“‹ æ¦‚è¿°
ä»Šæ—¥å®Œæˆäº† Daily Blog å°ˆæ¡ˆçš„æ ¸å¿ƒ CRUD åŠŸèƒ½ï¼Œæ¶µè“‹æ–‡ç« çš„æ–°å¢ã€è®€å–ã€åˆªé™¤ã€ç·¨è¼¯å››å¤§æ“ä½œã€‚
å¾ Service å±¤ â†’ Controller å±¤ â†’ View å±¤ï¼ŒæŒ‰ç…§ MVC æ¶æ§‹é€æ­¥å¯¦ä½œã€‚

## ğŸ¯ å®Œæˆé …ç›®
- [x] PostService æ–°å¢ `savePost()` æ–¹æ³• (å«è‡ªå‹•æ™‚é–“æˆ³è¨˜)
- [x] PostService æ–°å¢ `deletePost()` æ–¹æ³•
- [x] PostService æ–°å¢ `getPostById()` æ–¹æ³•
- [x] PostController å¯¦ä½œ `showCreateForm()` (GET /posts/new)
- [x] PostController å¯¦ä½œ `createPost()` (POST /posts)
- [x] PostController å¯¦ä½œ `deletePost()` (GET /posts/delete/{id})
- [x] PostController å¯¦ä½œ `editPost()` (GET /posts/edit/{id})
- [x] PostController å¯¦ä½œ `updatePost()` (POST /posts/edit/{id})
- [x] å»ºç«‹ `create_post.html` è¡¨å–®é é¢ (å« Bootstrap ç¾åŒ–)
- [x] å»ºç«‹ `edit_post.html` ç·¨è¼¯é é¢
- [x] é¦–é  (`index.html`) æ–°å¢ Edit / Delete æŒ‰éˆ•
- [x] é¦–é  (`index.html`) æ–°å¢ New Post æŒ‰éˆ• (Bug Fix: åŸæœ¬ç¼ºå°‘è·³è½‰åˆ° `/posts/new` çš„å…¥å£)
- [x] Context Loader Skill å»ºç«‹

## ğŸ“ ç•°å‹•æª”æ¡ˆ
| æª”æ¡ˆè·¯å¾‘ | ç•°å‹•é¡å‹ | èªªæ˜ |
|---------|---------|------|
| `service/PostService.java` | ä¿®æ”¹ | æ–°å¢ `savePost`ã€`deletePost`ã€`getPostById` ä¸‰å€‹æ–¹æ³• |
| `controller/PostController.java` | æ–°å¢ | å¯¦ä½œ CRUD å››å€‹ Handler Method |
| `templates/create_post.html` | æ–°å¢ | æ–°å¢æ–‡ç« è¡¨å–® (Thymeleaf + Bootstrap) |
| `templates/edit_post.html` | æ–°å¢ | ç·¨è¼¯æ–‡ç« è¡¨å–® (è¤‡è£½ create ä¸¦èª¿æ•´) |
| `templates/index.html` | ä¿®æ”¹ | æ–°å¢ Edit / Delete æŒ‰éˆ• |
| `.agent/skills/context-loader/SKILL.md` | æ–°å¢ | AI ä¸Šä¸‹æ–‡è¼‰å…¥æŠ€èƒ½ |

## ğŸ’¡ æŠ€è¡“æ±ºç­–

### æ±ºç­– 1: Constructor Injection vs @Autowired
- **èƒŒæ™¯**: æ³¨å…¥ Repository æ™‚ï¼Œä¸ä½¿ç”¨ `@Autowired` è¨»è§£
- **æ–¹æ¡ˆ**: ä½¿ç”¨å»ºæ§‹å­æ³¨å…¥ (Constructor Injection)
- **ç†ç”±**: Spring 4.3+ ç•¶é¡åˆ¥åªæœ‰ä¸€å€‹å»ºæ§‹å­æ™‚ï¼Œæœƒè‡ªå‹•æ³¨å…¥ã€‚æ­¤æ–¹å¼æ”¯æ´ `final` ä¸å¯è®Šæ€§ï¼Œä¸”æ˜“æ–¼å–®å…ƒæ¸¬è©¦ (ä¸éœ€å•Ÿå‹• Spring å®¹å™¨)

### æ±ºç­– 2: JPA save() çš„é›™é‡ç”¨é€”
- **èƒŒæ™¯**: æ–°å¢å’Œç·¨è¼¯éƒ½éœ€è¦å­˜æª”åŠŸèƒ½
- **æ–¹æ¡ˆ**: å…±ç”¨åŒä¸€å€‹ `savePost()` æ–¹æ³•
- **ç†ç”±**: JPA çš„ `save()` æœƒè‡ªå‹•åˆ¤æ–·ï¼š`id == null` æ™‚åŸ·è¡Œ INSERTï¼Œ`id != null` æ™‚åŸ·è¡Œ UPDATEã€‚æ‰€ä»¥ä¸éœ€è¦åˆ†åˆ¥å¯« `create` å’Œ `update` å…©å€‹æ–¹æ³•

### æ±ºç­– 3: Optional çš„è™•ç†
- **èƒŒæ™¯**: `findById()` å›å‚³ `Optional<Post>` è€Œéç›´æ¥å›å‚³ `Post`
- **æ–¹æ¡ˆ**: ä½¿ç”¨ `.orElse(null)` è§£åŒ…
- **ç†ç”±**: `Optional` æ˜¯ Java 8 çš„å®‰å…¨å®¹å™¨ï¼Œé¿å… NullPointerExceptionã€‚`.orElse(null)` è¡¨ç¤ºã€Œæ‰¾åˆ°å°±å›å‚³ï¼Œæ‰¾ä¸åˆ°å°±å›å‚³ nullã€

## ğŸ”§ ç¨‹å¼ç¢¼è®Šæ›´é‡é»

### PostService (æ¥­å‹™é‚è¼¯å±¤)
```java
// å„²å­˜æ–‡ç«  - è‡ªå‹•è£œä¸Šæ™‚é–“æˆ³è¨˜
public void savePost(Post post) {
    if (post.getCreatedTime() == null) {
        post.setCreatedTime(LocalDateTime.now());
    }
    postRepository.save(post);
}

// æŸ¥è©¢å–®ä¸€æ–‡ç«  - Optional è§£åŒ…
public Post getPostById(Long id) {
    return postRepository.findById(id).orElse(null);
}
```

### PostController (æ§åˆ¶å±¤)
```java
// ç·¨è¼¯ - GET: è¼‰å…¥ç¾æœ‰è³‡æ–™åˆ°è¡¨å–®
@GetMapping("posts/edit/{id}")
public String editPost(@PathVariable Long id, Model model) {
    Post post = postService.getPostById(id);
    model.addAttribute("post", post);
    return "edit_post";
}

// ç·¨è¼¯ - POST: æ¥æ”¶ä¿®æ”¹å¾Œçš„è³‡æ–™
@PostMapping("posts/edit/{id}")
public String updatePost(@PathVariable Long id, @ModelAttribute Post post) {
    post.setId(id);  // é—œéµï¼šè¨­å®š ID è®“ JPA åŸ·è¡Œ UPDATE è€Œé INSERT
    postService.savePost(post);
    return "redirect:/";
}
```

### Thymeleaf (å‰ç«¯æ¨¡æ¿)
```html
<!-- å‹•æ…‹ URL ç”¢ç”Ÿ - ä½¿ç”¨ @{} Link Expression -->
<a th:href="@{/posts/edit/{id}(id=${post.id})}">Edit</a>

<!-- è¡¨å–®ç‰©ä»¶ç¶å®š -->
<form th:action="@{/posts}" th:object="${post}" method="post">
    <input th:field="*{title}" class="form-control">
    <textarea th:field="*{content}" class="form-control"></textarea>
</form>
```

## ğŸ“ ä»Šæ—¥å­¸ç¿’ç­†è¨˜

### Spring MVC æ ¸å¿ƒè¨»è§£å°ç…§è¡¨
| è¨»è§£ | ç”¨é€” | ç¯„ä¾‹ |
|-----|------|------|
| `@GetMapping` | è™•ç† GET è«‹æ±‚ (è®€å–/é¡¯ç¤º) | é¡¯ç¤ºé é¢ã€æŸ¥è©¢è³‡æ–™ |
| `@PostMapping` | è™•ç† POST è«‹æ±‚ (æ–°å¢/ä¿®æ”¹) | æäº¤è¡¨å–®ã€å„²å­˜è³‡æ–™ |
| `@ModelAttribute` | è‡ªå‹•ç¶å®šè¡¨å–®è³‡æ–™åˆ°ç‰©ä»¶ | å–ä»£æ‰‹å‹• `request.getParameter()` |
| `@PathVariable` | å¾ URL è·¯å¾‘ä¸­æå–è®Šæ•¸ | `/posts/edit/{id}` â†’ `Long id` |

### Thymeleaf è¡¨é”å¼å°ç…§è¡¨
| èªæ³• | åç¨± | ç”¨é€” |
|-----|------|------|
| `${...}` | Variable Expression | å–å¾—è®Šæ•¸å€¼ |
| `*{...}` | Selection Expression | ç¶å®šç‰©ä»¶å±¬æ€§ (æ­é… `th:object`) |
| `@{...}` | Link URL Expression | ç”¢ç”Ÿ URL (è‡ªå‹•è™•ç† Context Path) |

## ğŸ”— ç›¸é—œé€£çµ
- [Spring Data JPA - save() æ–‡ä»¶](https://docs.spring.io/spring-data/jpa/docs/current/reference/html/)
- [Thymeleaf å®˜æ–¹æ•™å­¸](https://www.thymeleaf.org/doc/tutorials/3.1/usingthymeleaf.html)
