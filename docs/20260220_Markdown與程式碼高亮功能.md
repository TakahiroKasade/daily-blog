# 2026/02/20 - Phase 6 Markdown 支援與單頁文章功能

## 1. 功能變更 (Feature Changes)
### 1.1 Markdown 渲染 (Markdown Rendering)
- **Feature**: 支援使用 Markdown 語法撰寫文章，後端自動轉換為 HTML。
- **Library**: 使用 `commonmark-java` 函式庫。
- **Components**:
    - `Parser`: 負責讀取 Markdown 文字並解析成語法樹 (Node Tree)。
    - `HtmlRenderer`: 負責將語法樹轉換為標準的 HTML 標籤。
    - `TablesExtension`: 擴充功能，讓 Parser 看得懂 GitHub 風格的表格 (GFM Tables)。
- **註記**: 這些類別**並非 Spring Boot 內建**，而是來自第三方套件 `org.commonmark`。

### 1.2 單頁文章閱讀 (Single Post View)
- **Endpoint**: `/posts/{id}`
- **View**: `post.html` (待實作)
- **Logic**: 
    1. `PostController` 接收請求。
    2. 呼叫 `MarkdownService` 將 content 轉為 HTML。
    2. 呼叫 `MarkdownService` 將 content 轉為 HTML。
    3. 前端使用 `th:utext` 顯示轉換後的 HTML (不轉義)。

### 1.3 文章摘要功能 (Post Excerpt)
- **Problem**: 首頁直接顯示 Markdown 原始碼會造成版面混亂。
- **Solution**: 
    - `MarkdownService` 新增 `getExcerpt(String markdown, int maxLength)` 方法。
    - 使用 `TextContentRenderer` 去除所有 Markdown 符號 (如 `#`, `**`)。
    - 截取前 100 字作為純文字摘要顯示於首頁。

### 1.4 圖片上傳功能 (Local Image Upload)
- **Feature**: 支援文章與專案上傳封面圖片 (取代僅能使用 URL)。
- **Implementation**:
    - `FileStorageService`: 負責將上傳的檔案儲存至專案根目錄的 `uploads/` 資料夾。
    - `WebMvcConfig`: 設定靜態資源對應，讓瀏覽器可透過 `/uploads/**` 存取圖片。
    - **Frontend**: 表單新增 `enctype="multipart/form-data"` 與 `<input type="file">`。

## 2. 關於 CommonMark (Technical Deep Dive)
本次新增的 `MarkdownService` 使用了 `commonmark-java` 套件，這是一個遵循 CommonMark 規範的 Java 實作。
這**不是** Spring Boot 的一部分，我們必須在 `pom.xml` 中手動加入依賴才能使用。

### 核心元件介紹
1.  **Parser (解析器)**:
    -   就像翻譯機的「聽力部分」，它負責讀懂你寫的 `# 標題` 或 `**粗體**`，把這些符號變成程式能理解的物件。
2.  **HtmlRenderer (HTML 渲染器)**:
    -   就像翻譯機的「口說部分」，它把解析器產生的物件，變成瀏覽器看得懂的 `<h1>標題</h1>` 或 `<strong>粗體</strong>`。
3.  **Extensions (擴充套件)**:
    -   標準 Markdown 不支援表格，所以我們外掛了 `TablesExtension` 來「教」解析器看得懂表格。

## 3. 檔案變更
- `pom.xml`: 新增 `commonmark`, `commonmark-ext-gfm-tables`.
- `src/main/java/com/dailycoding/blog/service/MarkdownService.java`: 封裝轉換邏輯。
- `src/main/java/com/dailycoding/blog/controller/PostController.java`: 新增 `viewPost` 方法。
